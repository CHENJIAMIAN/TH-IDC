"use strict";(self["webpackChunkTH_IDC"]=self["webpackChunkTH_IDC"]||[]).push([[5641],{75641:function(e,t,i){i.r(t),i.d(t,{default:function(){return m}});var l=function(){var e=this,t=e.$createElement,l=e._self._c||t;return e.showPage?l("div",{staticClass:"app-container auth-manage"},[e.hasAuth?e._e():l("h2",{staticClass:"auth-tip"},[e._v("权限不足,请联系管理员")]),e.hasAuth?l("div",{staticClass:"head"},[l("el-form",{ref:"filterForm",staticStyle:{display:"grid","grid-auto-flow":"column"},attrs:{inline:!0,size:"medium",model:e.filterForm}},[l("el-form-item",{attrs:{prop:"level1Id"}},[l("el-select",{attrs:{clearable:"",placeholder:"子系统名称"},on:{change:function(){e.$set(e.filterForm,"level2Id",null),e.$set(e.filterForm,"menuId",null)}},model:{value:e.filterForm.level1Id,callback:function(t){e.$set(e.filterForm,"level1Id",t)},expression:"filterForm.level1Id"}},e._l(e.firstMenuOpts,(function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),l("el-form-item",{attrs:{prop:"level2Id"}},[l("el-select",{attrs:{clearable:"",placeholder:"模块名称"},on:{change:function(t){return e.$set(e.filterForm,"menuId",null)}},model:{value:e.filterForm.level2Id,callback:function(t){e.$set(e.filterForm,"level2Id",t)},expression:"filterForm.level2Id"}},e._l(e.secondMenuOpts,(function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),l("el-form-item",{attrs:{prop:"menuId"}},[l("el-select",{attrs:{clearable:"",placeholder:"菜单名称"},model:{value:e.filterForm.menuId,callback:function(t){e.$set(e.filterForm,"menuId",t)},expression:"filterForm.menuId"}},e._l(e.thirdMenuOpts,(function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),l("el-form-item",{attrs:{prop:"name"}},[l("el-input",{attrs:{placeholder:"权限名称"},model:{value:e.filterForm.name,callback:function(t){e.$set(e.filterForm,"name","string"===typeof t?t.trim():t)},expression:"filterForm.name"}})],1),l("el-form-item",[l("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleQuery}})],1),l("el-form-item",[l("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",plain:""},on:{click:function(t){return e.handleReset("filterForm")}}},[e._v("重置")])],1),l("el-form-item",[l("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.handleDialog()}}},[l("i",{staticClass:"el-icon-plus"})])],1)],1)],1):e._e(),e.hasAuth?l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{"empty-text":" ",height:"100%",stripe:"",border:"",data:e.listData}},[l("el-table-column",{attrs:{sortable:"",prop:"name",label:"权限名称"}}),l("el-table-column",{attrs:{prop:"permission",label:"标签"}}),l("el-table-column",{attrs:{prop:"level1Name",label:"所属模块名称"}}),l("el-table-column",{attrs:{prop:"level2Name",label:"所属子系统名称"}}),l("el-table-column",{attrs:{prop:"level3Name",label:"所属菜单名称"}}),l("el-table-column",{attrs:{label:"操作",align:"center",width:"161"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[l("el-button",{attrs:{title:"编辑",icon:"el-icon-edit-outline",type:"primary",plain:""},on:{click:function(t){return e.handleDialog(i)}}}),l("el-button",{attrs:{title:"删除",icon:"el-icon-delete",type:"primary",plain:""},on:{click:function(t){return e.handleDel(i.id)}}})]}}],null,!1,1998501215)})],1):e._e(),e.hasAuth?l("pagination",{attrs:{hidden:!(e.listTotal>0),total:e.listTotal,page:e.filterForm.pageNo,limit:e.filterForm.pageSize},on:{"update:page":function(t){return e.$set(e.filterForm,"pageNo",t)},"update:limit":function(t){return e.$set(e.filterForm,"pageSize",t)},pagination:e.getList}}):e._e(),l("el-dialog",{attrs:{visible:e.dialog.visible,top:"20vh"},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)}}},[l("div",{staticClass:"el-dialog-title-custom",attrs:{slot:"title"},slot:"title"},[l("span",{staticClass:"title-txt"},[e._v(e._s(e.dialog.forms.id?"编辑":"新增"))]),l("img",{attrs:{src:i(1612)}})]),l("el-form",{ref:"dialogForm",attrs:{model:e.dialog.forms,rules:e.dialog.rules,"label-width":"100px"}},[l("el-form-item",{attrs:{label:"权限名称",prop:"name"}},[l("el-input",{model:{value:e.dialog.forms.name,callback:function(t){e.$set(e.dialog.forms,"name",t)},expression:"dialog.forms.name"}})],1),l("el-form-item",{attrs:{label:"权限标签",prop:"permission"}},[l("el-input",{model:{value:e.dialog.forms.permission,callback:function(t){e.$set(e.dialog.forms,"permission",t)},expression:"dialog.forms.permission"}})],1),l("el-form-item",{attrs:{label:"子系统",prop:"firstMenuId"}},[l("el-select",{on:{change:function(){e.$set(e.dialog.forms,"secondMenuId",""),e.$set(e.dialog.forms,"thirdMenuId","")}},model:{value:e.dialog.forms.firstMenuId,callback:function(t){e.$set(e.dialog.forms,"firstMenuId",t)},expression:"dialog.forms.firstMenuId"}},e._l(e.firstMenuOpts,(function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),l("el-form-item",{attrs:{label:"模块",prop:"secondMenuId"}},[l("el-select",{on:{change:function(t){return e.$set(e.dialog.forms,"thirdMenuId","")}},model:{value:e.dialog.forms.secondMenuId,callback:function(t){e.$set(e.dialog.forms,"secondMenuId",t)},expression:"dialog.forms.secondMenuId"}},e._l(e.secondMenuOpts,(function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),l("el-form-item",{attrs:{label:"菜单",prop:"thirdMenuId"}},[l("el-select",{model:{value:e.dialog.forms.thirdMenuId,callback:function(t){e.$set(e.dialog.forms,"thirdMenuId",t)},expression:"dialog.forms.thirdMenuId"}},e._l(e.thirdMenuOpts,(function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),l("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[l("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:e.dialogSubmit}},[e._v("保 存")])],1)],1)],1):e._e()},s=[],a=i(87130),r=i(42070),n={components:{pagination:a.Z},data(){return{showPage:!1,hasAuth:!0,depOpts:[],firstMenuOpts:[],secondMenuOpts:[],thirdMenuOpts:[],filterForm:{name:"",menuId:null,level2Id:null,level1Id:null,pageNo:1,pageSize:10},listLoading:!0,listData:[],listTotal:0,dialog:{id:"",visible:!1,forms:{},rules:{name:[{required:!0,trigger:"blur",message:"请输入"}],permission:[{required:!0,trigger:"blur",message:"请输入"}],menuType:[{required:!0,trigger:"change",message:"请输入"}],firstMenuId:[{required:!0,trigger:"blur",message:"请输入"}],secondMenuId:[{required:!0,trigger:"blur",message:"请输入"}],thirdMenuId:[{required:!0,trigger:"blur",message:"请输入"}]}}}},watch:{async"filterForm.level1Id"(e,t){if(!e)return;this.secondMenuOpts=[],this.thirdMenuOpts=[];const i=await(0,r.Ee)({parentId:e,menuType:2});this.secondMenuOpts=i.data},async"filterForm.level2Id"(e,t){if(!e)return;this.thirdMenuOpts=[];const i=await(0,r.Ee)({parentId:e,menuType:3});this.thirdMenuOpts=i.data},async"dialog.forms.firstMenuId"(e,t){if(!e)return;this.secondMenuOpts=[],this.thirdMenuOpts=[];const i=await(0,r.Ee)({parentId:e,menuType:2});this.secondMenuOpts=i.data},async"dialog.forms.secondMenuId"(e,t){if(!e)return;this.thirdMenuOpts=[];const i=await(0,r.Ee)({parentId:e,menuType:3});this.thirdMenuOpts=i.data}},async created(){const e=await(0,r.Ee)({menuType:1});this.firstMenuOpts=e.data,this.handleQuery()},mounted(){},methods:{dialogSubmit(){this.$refs["dialogForm"].validate(((e,t)=>{if(!e)return!1;{let e=null;if(!this.dialog.forms.thirdMenuId)return void this.$message.error("请选择父级菜单");this.dialog.forms.menuId=this.dialog.forms.thirdMenuId,e=this.dialog.forms.id?r.o_:r.eV,e(this.dialog.forms).then((e=>{this.$message.success("操作成功!"),this.$refs["dialogForm"].resetFields(),this.dialog.visible=!1,this.getList()}))}}))},handleQuery(){this.listTotal=0,this.filterForm.pageNo=1,this.getList()},handleReset(e){document.activeElement.blur(),this.$refs[e].resetFields(),this.handleQuery()},async handleDialog(e){const t=await(0,r.Ee)({menuType:1});if(this.firstMenuOpts=t.data,e){this.dialog.forms=Object.assign(JSON.parse(JSON.stringify(e))),console.log(this.dialog.forms);const t=await(0,r.Ee)({menuType:3}),i=await(0,r.Ee)({menuType:2});this.thirdMenuOpts=t.data,this.secondMenuOpts=i.data;const l=this.thirdMenuOpts.find((t=>t.id===e.menuId)),s=this.secondMenuOpts.find((e=>e.id===l.parentId)),a=this.firstMenuOpts.find((e=>e.id===s.parentId));this.$set(this.dialog.forms,"thirdMenuId",e.menuId),this.$set(this.dialog.forms,"secondMenuId",s.id),this.$set(this.dialog.forms,"firstMenuId",a.id)}else this.dialog.forms={};this.dialog.visible=!0,this.$nextTick((e=>this.$refs["dialogForm"].clearValidate()))},handleDel(e){this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,r.OE)({id:e}).then((e=>{this.getList(),this.$message.success("删除成功!")}))})).catch((()=>{}))},getList(){this.listLoading=!0,(0,r.uT)(this.filterForm).then((e=>{this.hasAuth=!0,this.listData=e.data.list,this.listTotal=e.data.total,this.listLoading=!1})).catch((e=>{this.hasAuth=!1})).finally((e=>{this.showPage=!0}))}}},o=n,d=i(35471),u=(0,d.Z)(o,l,s,!1,null,"5d1fbeae",null),m=u.exports}}]);