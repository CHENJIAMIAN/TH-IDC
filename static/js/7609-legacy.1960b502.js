(self["webpackChunkTH_IDC"]=self["webpackChunkTH_IDC"]||[]).push([[7609],{53741:function(e,t,i){var o=i(28887),r=Math.floor;e.exports=Number.isInteger||function(e){return!o(e)&&isFinite(e)&&r(e)===e}},61194:function(e,t,i){"use strict";var o=i(32538),r=i(35565).find,a=i(35707),l="find",n=!0;l in[]&&Array(1)[l]((function(){n=!1})),o({target:"Array",proto:!0,forced:n},{find:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),a(l)},16544:function(e,t,i){var o=i(32538),r=i(53741);o({target:"Number",stat:!0},{isInteger:r})},72802:function(e,t,i){"use strict";i.d(t,{P:function(){return r}});i(63810);var o="",r=o+"/admin/uploadFile/upload"},41849:function(e,t,i){"use strict";i.d(t,{C0:function(){return s},Mj:function(){return a},Uz:function(){return m},eW:function(){return n},ed:function(){return l}});var o,r=i(20638),a=(i(16544),i(24238),i(48503),[{id:1,name:"整型"},{id:2,name:"长整型"},{id:3,name:"浮点型"},{id:4,name:"布尔型"},{id:5,name:"字符串"},{id:6,name:"时间戳"}]),l=[{id:1,name:"邮箱"},{id:2,name:"短信"},{id:3,name:"语音"},{id:4,name:"微信"},{id:5,name:"钉钉"},{id:6,name:"声光"}],n=(o={id:1,name:"母联柜"},(0,r.Z)(o,"id",2),(0,r.Z)(o,"name","直流操作电源柜"),(0,r.Z)(o,"id",3),(0,r.Z)(o,"name","变压器"),(0,r.Z)(o,"id",4),(0,r.Z)(o,"name","低压进线柜"),(0,r.Z)(o,"id",5),(0,r.Z)(o,"name","配电柜"),(0,r.Z)(o,"id",6),(0,r.Z)(o,"name","柴油发电机组"),(0,r.Z)(o,"id",7),(0,r.Z)(o,"name","蓄电池"),(0,r.Z)(o,"id",8),(0,r.Z)(o,"name","UPS主机"),(0,r.Z)(o,"id",9),(0,r.Z)(o,"name","UPS变换器"),(0,r.Z)(o,"id",10),(0,r.Z)(o,"name","UPS逆变器"),(0,r.Z)(o,"id",11),(0,r.Z)(o,"name","列头柜"),(0,r.Z)(o,"id",12),(0,r.Z)(o,"name","空调"),(0,r.Z)(o,"id",13),(0,r.Z)(o,"name","温湿度"),(0,r.Z)(o,"id",14),(0,r.Z)(o,"name","氢气探测器"),(0,r.Z)(o,"id",15),(0,r.Z)(o,"name","水浸"),[{id:1,name:"北向开关"},{id:2,name:"东向开关"},{id:3,name:"西向开关"},{id:4,name:"南向开关"},{id:5,name:"温度计"}]),s=function(e,t,i){e.required||void 0!==t&&""!==t||i(),""===t||!Number.isInteger(+t)||+t<0?i(new Error("请输入整数值")):i()},m=function(e,t,i){""===t||isNaN(t)||Number(t)<0?i(new Error("请输入非负数字")):i()}},87609:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return h}});var o=function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.showPage?o("div",{staticClass:"app-container room-manage"},[e.hasAuth?e._e():o("h2",{staticClass:"auth-tip"},[e._v("权限不足,请联系管理员")]),e.hasAuth?o("div",{staticClass:"head"},[o("el-form",{ref:"filterForm",staticStyle:{display:"grid","grid-auto-flow":"column"},attrs:{inline:!0,size:"medium",model:e.filterForm}},[o("el-form-item",{attrs:{prop:"floorCode"}},[o("el-select",{attrs:{clearable:"",placeholder:"楼层"},model:{value:e.filterForm.floorCode,callback:function(t){e.$set(e.filterForm,"floorCode",t)},expression:"filterForm.floorCode"}},e._l(e.floorOpts,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.floorCode}})})),1)],1),o("el-form-item",{attrs:{prop:"name"}},[o("el-input",{attrs:{placeholder:"房间名称"},model:{value:e.filterForm.name,callback:function(t){e.$set(e.filterForm,"name","string"===typeof t?t.trim():t)},expression:"filterForm.name"}})],1),o("el-form-item",{attrs:{prop:"roomType"}},[o("el-select",{attrs:{clearable:"",placeholder:"房间类型"},model:{value:e.filterForm.roomType,callback:function(t){e.$set(e.filterForm,"roomType",t)},expression:"filterForm.roomType"}},e._l(e.roomTypeOpts,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleQuery}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",plain:""},on:{click:function(t){return e.handleReset("filterForm")}}},[e._v("重置")])],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.handleDialog()}}},[o("i",{staticClass:"el-icon-plus"})])],1)],1)],1):e._e(),e.hasAuth?o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{"empty-text":" ",height:"100%",stripe:"",border:"",data:e.listData}},[o("el-table-column",{attrs:{prop:"roomCode",label:"房间编号"}}),o("el-table-column",{attrs:{prop:"name",label:"房间名称"}}),o("el-table-column",{attrs:{prop:"roomType",label:"房间类型"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[o("span",[e._v(e._s(e._f("capitalize")(i.roomType)))])]}}],null,!1,3987805006)}),o("el-table-column",{attrs:{prop:"imgUrl",label:"预览图"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[o("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){e.dialogImgVisible=!0,e.dialogImgUrl=i.imgUrl}}},[e._v("查看")])]}}],null,!1,2063936953)}),o("el-table-column",{attrs:{sortable:"",prop:"sort",label:"排序"}}),o("el-table-column",{attrs:{prop:"floorName",label:"楼层名称"}}),o("el-table-column",{attrs:{label:"操作",align:"center",width:"161"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[o("el-button",{attrs:{title:"编辑",icon:"el-icon-edit-outline",type:"primary",plain:""},on:{click:function(t){return e.handleDialog(i)}}}),o("el-button",{attrs:{title:"删除",icon:"el-icon-delete",type:"primary",plain:""},on:{click:function(t){return e.handleDel(i.id)}}})]}}],null,!1,1998501215)})],1):e._e(),e.hasAuth?o("pagination",{attrs:{hidden:!(e.listTotal>0),total:e.listTotal,page:e.filterForm.pageNo,limit:e.filterForm.pageSize},on:{"update:page":function(t){return e.$set(e.filterForm,"pageNo",t)},"update:limit":function(t){return e.$set(e.filterForm,"pageSize",t)},pagination:e.getList}}):e._e(),o("el-dialog",{attrs:{"custom-class":"dialog-img",visible:e.dialogImgVisible},on:{"update:visible":function(t){e.dialogImgVisible=t}}},[o("img",{staticClass:"preview-img",attrs:{src:e.dialogImgUrl,alt:"加载失败"}})]),o("el-dialog",{attrs:{visible:e.dialog.visible},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)}}},[o("div",{staticClass:"el-dialog-title-custom",attrs:{slot:"title"},slot:"title"},[o("span",{staticClass:"title-txt"},[e._v(e._s(e.dialog.forms.id?"编辑":"新增"))]),o("img",{attrs:{src:i(1612)}})]),o("el-form",{ref:"dialogForm",attrs:{model:e.dialog.forms,rules:e.dialog.rules,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"房间编号",prop:"roomCode"}},[o("el-input",{attrs:{disabled:!!e.dialog.forms.id},model:{value:e.dialog.forms.roomCode,callback:function(t){e.$set(e.dialog.forms,"roomCode",t)},expression:"dialog.forms.roomCode"}})],1),o("el-form-item",{attrs:{label:"房间名称",prop:"name"}},[o("el-input",{model:{value:e.dialog.forms.name,callback:function(t){e.$set(e.dialog.forms,"name",t)},expression:"dialog.forms.name"}})],1),o("div",{staticStyle:{display:"grid","grid-template-columns":"1fr 1fr 1fr"}},[o("el-form-item",{attrs:{label:"楼层",prop:"floorCode"}},[o("el-select",{model:{value:e.dialog.forms.floorCode,callback:function(t){e.$set(e.dialog.forms,"floorCode",t)},expression:"dialog.forms.floorCode"}},e._l(e.floorOpts,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.floorCode}})})),1)],1),o("el-form-item",{attrs:{label:"房间类型",prop:"roomType"}},[o("el-select",{model:{value:e.dialog.forms.roomType,callback:function(t){e.$set(e.dialog.forms,"roomType",t)},expression:"dialog.forms.roomType"}},e._l(e.roomTypeOpts,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),o("el-form-item",{attrs:{label:"排序",prop:"sort"}},[o("el-input",{model:{value:e.dialog.forms.sort,callback:function(t){e.$set(e.dialog.forms,"sort",t)},expression:"dialog.forms.sort"}})],1)],1),e.dialog.visible?o("el-form-item",{attrs:{label:"预览图",prop:"imgUrl"}},[o("div",{staticClass:"preview-grid"},[o("el-upload",{ref:"upload",staticClass:"upload-container",attrs:{name:"attach",headers:e.headers,action:e.uploadUrl,data:e.uploadData,"on-success":e.uploadSuccess,"on-remove":e.fileRemove,limit:1,drag:""}},[o("i",{staticClass:"el-icon-upload"}),o("div",{staticClass:"el-upload__text"},[e._v(" 点击 "),o("em",[e._v("上传文件")]),e._v(" 或拖拽上传 ")])]),e.dialog.forms.imgUrl?o("img",{staticClass:"preview-img",attrs:{src:e.dialog.forms.imgUrl,alt:"图片加载失败"}}):e._e()],1)]):e._e()],1),o("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:e.dialogSubmit}},[e._v("保 存")])],1)],1)],1):e._e()},r=[],a=i(12516),l=(i(10405),i(23087),i(43023),i(61194),i(98469),i(17822),i(41849)),n=i(87130),s=i(5211),m=i(72802),d=i(41730),u=[],c={components:{pagination:n.Z},filters:{capitalize:function(e){if(!e)return"";e=e.toString();var t=u.find((function(t){return t.id==e}));return t?t.name:"错误数据,找不到对应类型"}},data:function(){return{showPage:!1,hasAuth:!0,uploadedFileUrl:"",headers:{token:(0,d.LP)()},uploadData:{type:2},uploadUrl:m.P,floorOpts:[],roomOpts:[],roomTypeOpts:[],firstMenuOpts:[],secondMenuOpts:[],filterForm:{floorCode:"",name:"",roomType:null,pageNo:1,pageSize:10},listLoading:!0,listData:[],listTotal:0,dialogImgVisible:!1,dialogImgUrl:"",dialog:{id:"",visible:!1,forms:{},rules:{floorCode:[{required:!0,trigger:"blur",message:"请输入"}],roomCode:[{required:!0,trigger:"blur",message:"请输入"}],name:[{required:!0,trigger:"blur",message:"请输入"}],roomType:[{required:!0,trigger:"blur",message:"请输入"}],imgUrl:[{required:!0,message:"请上传图片"}],sort:[{required:!0,trigger:"blur",validator:l.C0}]}}}},watch:{},created:function(){var e=this;return(0,a.Z)(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return(0,s.aJ)().then((function(t){return e.floorOpts=t.data})),(0,s.RE)().then((function(t){return e.roomOpts=t.data})),t.next=4,(0,s.D9)();case 4:i=t.sent,u=e.roomTypeOpts=i.data,e.handleQuery();case 7:case"end":return t.stop()}}),t)})))()},mounted:function(){},methods:{uploadSuccess:function(e,t,i){0===e.res?(this.dialog.forms.imgUrl=e.data.filePath,this.$message.success("上传成功!")):this.$message.error(e.msg),this.$refs["dialogForm"].validateField("imgUrl")},fileRemove:function(e,t){this.dialog.forms.imgUrl="",this.$refs["dialogForm"].validateField("imgUrl")},dialogSubmit:function(){var e=this;this.$refs["dialogForm"].validate((function(t,i){if(!t)return!1;var o=null;o=e.dialog.forms.id?s.OZ:s.Hc,o(e.dialog.forms).then((function(t){e.$message.success("操作成功!"),e.$refs["dialogForm"].resetFields(),e.dialog.visible=!1,e.getList()}))}))},handleQuery:function(){this.listTotal=0,this.filterForm.pageNo=1,this.getList()},handleReset:function(e){document.activeElement.blur(),this.$refs[e].resetFields(),this.handleQuery()},handleDialog:function(e){var t=this;return(0,a.Z)(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.dialog.forms=e?Object.assign(JSON.parse(JSON.stringify(e))):{imgUrl:""},t.dialog.visible=!0,t.$nextTick((function(e){return t.$refs["dialogForm"].clearValidate()}));case 3:case"end":return i.stop()}}),i)})))()},handleDel:function(e){var t=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,s.Kl)({id:e}).then((function(e){t.getList(),t.$message.success("删除成功!")}))})).catch((function(){}))},getList:function(){var e=this;this.listLoading=!0,(0,s.EA)(this.filterForm).then((function(t){e.hasAuth=!0,e.listData=t.data.list,e.listTotal=t.data.total,e.listLoading=!1})).catch((function(t){e.hasAuth=!1})).finally((function(t){e.showPage=!0}))}}},f=c,p=i(35471),g=(0,p.Z)(f,o,r,!1,null,"2bc2681e",null),h=g.exports}}]);