"use strict";(self["webpackChunkTH_IDC"]=self["webpackChunkTH_IDC"]||[]).push([[9253],{79253:function(e,t,i){i.r(t),i.d(t,{default:function(){return u}});var l=function(){var e=this,t=e.$createElement,l=e._self._c||t;return e.showPage?l("div",{staticClass:"app-container user-manage"},[e.hasAuth?e._e():l("h2",{staticClass:"auth-tip"},[e._v("权限不足,请联系管理员")]),e.hasAuth?l("div",{staticClass:"head"},[l("el-form",{staticStyle:{display:"grid","grid-auto-flow":"column"},attrs:{inline:!0,size:"medium"}},[l("el-form-item",[l("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.handleAdd}},[l("i",{staticClass:"el-icon-plus"})])],1)],1)],1):e._e(),e.hasAuth?l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticClass:"arrange-work-table",staticStyle:{width:"100%"},attrs:{"empty-text":" ",height:"100%",stripe:"",data:e.listData,"cell-class-name":e.tableCellClassName},on:{"cell-click":e.cellClick}},[l("el-table-column",{attrs:{prop:"id",label:"编号",align:"center"}}),l("el-table-column",{attrs:{prop:"week1List",label:"星期一",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;t.column,t.$index;return[i.week1List.length<1?l("div",{staticStyle:{color:"#a7a7a7"}},[e._v(" 待排班 ")]):e._e(),e._l(i.week1List,(function(t){return l("div",{key:t.id},[e._v(e._s(t.name))])}))]}}],null,!1,1484009718)}),l("el-table-column",{attrs:{prop:"week2List",label:"星期二",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;t.column,t.$index;return[i.week2List.length<1?l("div",{staticStyle:{color:"#a7a7a7"}},[e._v(" 待排班 ")]):e._e(),e._l(i.week2List,(function(t){return l("div",{key:t.id},[e._v(e._s(t.name))])}))]}}],null,!1,3790495958)}),l("el-table-column",{attrs:{prop:"week3List",label:"星期三",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;t.column,t.$index;return[i.week3List.length<1?l("div",{staticStyle:{color:"#a7a7a7"}},[e._v(" 待排班 ")]):e._e(),e._l(i.week3List,(function(t){return l("div",{key:t.id},[e._v(e._s(t.name))])}))]}}],null,!1,907564342)}),l("el-table-column",{attrs:{prop:"week4List",label:"星期四",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;t.column,t.$index;return[i.week4List.length<1?l("div",{staticStyle:{color:"#a7a7a7"}},[e._v(" 待排班 ")]):e._e(),e._l(i.week4List,(function(t){return l("div",{key:t.id},[e._v(e._s(t.name))])}))]}}],null,!1,3072354582)}),l("el-table-column",{attrs:{prop:"week5List",label:"星期五",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;t.column,t.$index;return[i.week5List.length<1?l("div",{staticStyle:{color:"#a7a7a7"}},[e._v(" 待排班 ")]):e._e(),e._l(i.week5List,(function(t){return l("div",{key:t.id},[e._v(e._s(t.name))])}))]}}],null,!1,1812629878)}),l("el-table-column",{attrs:{prop:"week6List",label:"星期六",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;t.column,t.$index;return[i.week6List.length<1?l("div",{staticStyle:{color:"#a7a7a7"}},[e._v(" 待排班 ")]):e._e(),e._l(i.week6List,(function(t){return l("div",{key:t.id},[e._v(e._s(t.name))])}))]}}],null,!1,790022486)}),l("el-table-column",{attrs:{prop:"week7List",label:"星期日",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;t.column,t.$index;return[i.week7List.length<1?l("div",{staticStyle:{color:"#a7a7a7"}},[e._v(" 待排班 ")]):e._e(),e._l(i.week7List,(function(t){return l("div",{key:t.id},[e._v(e._s(t.name))])}))]}}],null,!1,2309416374)}),l("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[l("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(t){return e.handleStatusChange(t,i)}},model:{value:i.status,callback:function(t){e.$set(i,"status",t)},expression:"row.status"}})]}}],null,!1,83028734)}),l("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[l("el-button",{attrs:{title:"删除",icon:"el-icon-delete",type:"primary",plain:""},on:{click:function(t){return e.handleDel(i.id)}}})]}}],null,!1,2849497724)})],1):e._e(),l("el-dialog",{attrs:{visible:e.dialogRY.visible},on:{"update:visible":function(t){return e.$set(e.dialogRY,"visible",t)}}},[l("div",{staticClass:"el-dialog-title-custom",attrs:{slot:"title"},slot:"title"},[l("div",{staticClass:"title-txt"},[e._v("绑定排班人员")]),l("img",{attrs:{src:i(1612)}})]),l("el-form",{ref:"dialogRYForm",staticStyle:{display:"grid","justify-content":"center"},attrs:{model:e.dialogRY.forms,rules:e.dialogRY.rules,"label-width":"50"}},[l("el-form-item",{attrs:{label:"",prop:""}},[l("el-transfer",{attrs:{filterable:"","filter-method":function(e,t){return t.name.indexOf(e)>-1},titles:["未绑定","已绑定"],props:{key:"id",label:"name"},"filter-placeholder":"请输入",data:e.allRYOpts},model:{value:e.dialogRY.forms.personIdArray,callback:function(t){e.$set(e.dialogRY.forms,"personIdArray",t)},expression:"dialogRY.forms.personIdArray"}})],1)],1),l("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[l("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:e.dialogRYSubmit}},[e._v("保 存")])],1)],1)],1):e._e()},a=[],s=i(87130),n=i(97595),o={components:{pagination:s.Z},data(){return{showPage:!1,hasAuth:!0,userNotBindOpts:[],userBindOpts:[],listLoading:!0,listData:[],allRYOpts:[],clickedRow:{},clickedColumn:{},dialogRY:{visible:!1,forms:{},rules:{}}}},created(){this.handleQuery()},mounted(){},methods:{dialogRYSubmit(){const e=this.clickedRow,t=this.clickedColumn;console.log(e,t),console.log(this.dialogRY.forms),this.$refs["dialogRYForm"].validate(((i,l)=>{if(!i)return!1;this.dialogRY.forms,(0,n.lm)({id:e.id,week:t.index,userIdArray:this.dialogRY.forms.personIdArray}).then((i=>{this.$set(e,`week${t.index}ListAll`,i.data),this.$message.success("操作成功!"),this.$refs["dialogRYForm"].resetFields(),this.dialogRY.visible=!1,this.getList()}))}))},async handleRYDialog({row:e,column:t,cell:i,event:l}){this.dialogRY.forms={id:e.id};const a=await(0,n.gO)({id:e.id,week:t.index});this.userNotBindOpts=a.data;const s=await(0,n.yr)({id:e.id,week:t.index});this.userBindOpts=s.data,this.$set(this.dialogRY.forms,"personIdArray",s.data.map((e=>e.id))),this.allRYOpts=this.userNotBindOpts.concat(this.userBindOpts),this.dialogRY.visible=!0,this.$nextTick((e=>this.$refs["dialogRYForm"].clearValidate()))},handleStatusChange(e,t){(0,n.Xc)({id:t.id,status:e}).then((e=>{this.getList()})).catch((i=>{t.status=2===e?1:2}))},tableCellClassName({row:e,column:t,rowIndex:i,columnIndex:l}){if(e.index=i,t.index=l,t.index>0&&t.index<8)return"week-day"},cellClick(e,t,i,l){this.clickedRow=e,this.clickedColumn=t,t.index>0&&t.index<8&&this.handleRYDialog({row:e,column:t,cell:i,event:l})},handlePersonSelectVisibleChange(e,{row:t,column:i,$index:l}){e&&i.index>0&&i.index<8&&(0,n.gO)({id:t.id,week:i.index}).then((e=>{this.$set(t,`week${i.index}ListAll`,e.data)}))},handleQuery(){this.getList()},handleAdd(){(0,n.i9)().then((e=>{this.getList()}))},handleDel(e){this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,n.Dv)({id:e}).then((e=>{this.getList(),this.$message.success("删除成功!")}))})).catch((()=>{}))},getList(){this.listLoading=!0,(0,n.Jr)().then((e=>{this.hasAuth=!0,this.listData=e.data,this.listData.map(((e,t)=>{e.week1IdList=e.week1List.map((e=>e.name)),e.week2IdList=e.week2List.map((e=>e.name)),e.week3IdList=e.week3List.map((e=>e.name)),e.week4IdList=e.week4List.map((e=>e.name)),e.week5IdList=e.week5List.map((e=>e.name)),e.week6IdList=e.week6List.map((e=>e.name)),e.week7IdList=e.week7List.map((e=>e.name))})),console.log(this.listData),this.listLoading=!1})).catch((e=>{this.hasAuth=!1})).finally((e=>{this.showPage=!0}))}}},r=o,d=i(35471),c=(0,d.Z)(r,l,a,!1,null,"07da9501",null),u=c.exports}}]);