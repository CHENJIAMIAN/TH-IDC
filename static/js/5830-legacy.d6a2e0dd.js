"use strict";(self["webpackChunkTH_IDC"]=self["webpackChunkTH_IDC"]||[]).push([[5830],{95830:function(t,e,i){i.r(e),i.d(e,{default:function(){return f}});var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.showPage?a("div",{staticClass:"app-container role-manage"},[t.hasAuth?t._e():a("h2",{staticClass:"auth-tip"},[t._v("权限不足,请联系管理员")]),t.hasAuth?a("div",{staticClass:"head"},[a("el-form",{ref:"filterForm",attrs:{inline:!0,size:"medium",model:t.filterForm}},[a("el-form-item",{attrs:{prop:"searchName"}},[a("el-input",{attrs:{placeholder:"名称"},model:{value:t.filterForm.searchName,callback:function(e){t.$set(t.filterForm,"searchName","string"===typeof e?e.trim():e)},expression:"filterForm.searchName"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleQuery}}),a("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",plain:""},on:{click:function(e){return t.handleReset("filterForm")}}},[t._v("重置")]),a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(e){return t.handleDialog()}}},[a("i",{staticClass:"el-icon-plus"})])],1)],1)],1):t._e(),t.hasAuth?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{"empty-text":" ",height:"100%",stripe:"",border:"",data:t.listData}},[a("el-table-column",{attrs:{sortable:"",prop:"name",label:"角色名称"}}),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),a("el-table-column",{attrs:{prop:"createUserName",label:"创建人"}}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-button",{attrs:{title:"绑定房间",icon:"el-icon-bdfj",type:"primary",plain:""},on:{click:function(e){return t.handleFJDialog(i)}}}),a("el-button",{attrs:{title:"绑定权限",icon:"el-icon-bdqx",type:"primary",plain:""},on:{click:function(e){return t.handleQXDialog(i)}}}),a("el-button",{attrs:{title:"编辑",icon:"el-icon-edit-outline",type:"primary",plain:""},on:{click:function(e){return t.handleDialog(i)}}}),a("el-button",{attrs:{title:"删除",icon:"el-icon-delete",type:"primary",plain:""},on:{click:function(e){return t.handleDel(i.id)}}})]}}],null,!1,3584168647)})],1):t._e(),t.hasAuth?a("pagination",{attrs:{hidden:!(t.listTotal>0),total:t.listTotal,page:t.filterForm.pageNo,limit:t.filterForm.pageSize},on:{"update:page":function(e){return t.$set(t.filterForm,"pageNo",e)},"update:limit":function(e){return t.$set(t.filterForm,"pageSize",e)},pagination:t.getList}}):t._e(),a("el-dialog",{attrs:{visible:t.dialog.visible,top:"25vh"},on:{"update:visible":function(e){return t.$set(t.dialog,"visible",e)}}},[a("div",{staticClass:"el-dialog-title-custom",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-txt"},[t._v(t._s(t.dialog.forms.id?"编辑":"新增"))]),a("img",{attrs:{src:i(1612)}})]),a("el-form",{ref:"dialogForm",attrs:{model:t.dialog.forms,rules:t.dialog.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[a("el-input",{model:{value:t.dialog.forms.name,callback:function(e){t.$set(t.dialog.forms,"name",e)},expression:"dialog.forms.name"}})],1)],1),a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:t.dialogSubmit}},[t._v("保 存")])],1)],1),a("el-dialog",{attrs:{visible:t.dialogFJ.visible},on:{"update:visible":function(e){return t.$set(t.dialogFJ,"visible",e)}}},[a("div",{staticClass:"el-dialog-title-custom",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-txt"},[t._v("绑定房间")]),a("img",{attrs:{src:i(1612)}})]),a("el-form",{ref:"dialogFJForm",staticStyle:{padding:"0 1rem"},attrs:{model:t.dialogFJ.forms,rules:t.dialogFJ.rules,"label-position":"top"}},t._l(t.treeDataFJ,(function(e){return a("el-form-item",{key:e.id,staticClass:"rooms-form-item",attrs:{label:e.name,prop:"name"}},[a("el-checkbox-group",{staticClass:"rooms-el-checkbox-group",model:{value:t.dialogFJ.forms.roomIdArray,callback:function(e){t.$set(t.dialogFJ.forms,"roomIdArray",e)},expression:"dialogFJ.forms.roomIdArray"}},t._l(e.roomList,(function(e){return a("el-checkbox",{key:e.id,attrs:{label:e.id,border:""}},[t._v(t._s(e.name))])})),1)],1)})),1),a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:t.dialogFJSubmit}},[t._v("保 存")])],1)],1),a("el-dialog",{attrs:{visible:t.dialogQX.visible},on:{"update:visible":function(e){return t.$set(t.dialogQX,"visible",e)}}},[a("div",{staticClass:"el-dialog-title-custom",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-txt"},[t._v("绑定权限")]),a("img",{attrs:{src:i(1612)}})]),a("el-form",{ref:"dialogQXForm",staticStyle:{display:"grid","justify-content":"center"},attrs:{model:t.dialogQX.forms,rules:t.dialogQX.rules}},[a("el-tree",{ref:"treeQX",attrs:{"default-expand-all":"","node-key":"id","default-checked-keys":t.defaultCheckedIdsQX,data:t.treeDataQX,props:{children:"child",label:"name"},"show-checkbox":""}})],1),a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:t.dialogQXSubmit}},[t._v("保 存")])],1)],1)],1):t._e()},l=[],o=i(62032),r=(i(21249),i(57327),i(41539),i(38862),i(94685)),s=i(54625),n={components:{pagination:r.Z},data:function(){return{showPage:!1,hasAuth:!0,filterForm:{searchName:"",pageNo:1,pageSize:10},listLoading:!0,listData:[],listTotal:0,treeDataQX:[],treeDataFJ:[],defaultCheckedIdsQX:[],dialog:{id:"",visible:!1,forms:{},rules:{name:[{required:!0,trigger:"blur",message:"请输入"}]}},dialogFJ:{visible:!1,forms:{},rules:{}},dialogQX:{visible:!1,forms:{},rules:{}}}},created:function(){this.handleQuery()},mounted:function(){},methods:{findRoot:function(t,e){var i=[];function a(t){var l,r=(0,o.Z)(t);try{for(r.s();!(l=r.n()).done;){var s=l.value;s[e]?a(s[e]):"1"==s.has&&i.push(s)}}catch(n){r.e(n)}finally{r.f()}}return a(t),i},dialogFJSubmit:function(){var t=this;this.$refs["dialogFJForm"].validate((function(e,i){if(!e)return!1;(0,s.CJ)(t.dialogFJ.forms).then((function(e){t.$message.success("操作成功!"),t.$refs["dialogFJForm"].resetFields(),t.dialogFJ.visible=!1,t.getList()}))}))},dialogQXSubmit:function(){var t=this;this.$refs["dialogQXForm"].validate((function(e,i){if(!e)return!1;t.dialogQX.forms.permissionIdArray=t.$refs["treeQX"].getCheckedNodes().filter((function(t){return t.has})).map((function(t){return t.id})),(0,s.R9)(t.dialogQX.forms).then((function(e){t.$message.success("操作成功!"),t.$refs["dialogQXForm"].resetFields(),t.dialogQX.visible=!1,t.getList()}))}))},dialogSubmit:function(){var t=this;this.$refs["dialogForm"].validate((function(e,i){if(!e)return!1;var a=null;a=t.dialog.forms.id?s.yy:s.D$,a(t.dialog.forms).then((function(e){t.$message.success("操作成功!"),t.$refs["dialogForm"].resetFields(),t.dialog.visible=!1,t.getList()}))}))},handleQuery:function(){this.listTotal=0,this.filterForm.pageNo=1,this.getList()},handleReset:function(t){document.activeElement.blur(),this.$refs[t].resetFields(),this.handleQuery()},handleDialog:function(t){var e=this;this.dialog.forms=t?JSON.parse(JSON.stringify(t)):{},this.dialog.visible=!0,this.$nextTick((function(t){return e.$refs["dialogForm"].clearValidate()}))},handleFJDialog:function(t){var e=this;(0,s.Q6)({roleId:t.id}).then((function(t){e.treeDataFJ=t.data;var i=e.findRoot(e.treeDataFJ,"roomList").map((function(t){return t.id}));e.$set(e.dialogFJ.forms,"roomIdArray",i)})),t?(this.dialogFJ.forms=JSON.parse(JSON.stringify({roleId:t.id})),this.$set(this.dialogFJ.forms,"roomIdArray",[])):this.dialogFJ.forms={},this.dialogFJ.visible=!0},handleQXDialog:function(t){var e=this;(0,s.I9)({roleId:t.id}).then((function(t){e.treeDataQX=t.data,e.defaultCheckedIdsQX=e.findRoot(e.treeDataQX,"child").map((function(t){return t.id}))})),this.dialogQX.forms=t?JSON.parse(JSON.stringify({roleId:t.id})):{},this.dialogQX.visible=!0},handleDel:function(t){var e=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,s.sK)({id:t}).then((function(t){e.getList(),e.$message.success("删除成功!")}))})).catch((function(){}))},getList:function(){var t=this;this.listLoading=!0,(0,s.VK)(this.filterForm).then((function(e){t.hasAuth=!0,t.listData=e.data.list,t.listTotal=e.data.total,t.listLoading=!1})).catch((function(e){t.hasAuth=!1})).finally((function(e){t.showPage=!0}))}}},d=n,c=i(1001),u=(0,c.Z)(d,a,l,!1,null,"5a8b87ad",null),f=u.exports}}]);