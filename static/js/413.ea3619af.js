"use strict";(self["webpackChunkTH_IDC"]=self["webpackChunkTH_IDC"]||[]).push([[413],{60413:function(e,i,t){t.r(i),t.d(i,{default:function(){return g}});var a=function(){var e=this,i=e.$createElement,a=e._self._c||i;return e.showPage?a("div",{staticClass:"app-container building-manage"},[e.hasAuth?e._e():a("h2",{staticClass:"auth-tip"},[e._v("权限不足,请联系管理员")]),e.hasAuth?a("div",{staticClass:"head"},[a("el-form",{ref:"filterForm",attrs:{inline:!0,size:"medium"}},[a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",plain:""},on:{click:e.handleReset}},[e._v("刷新缓存")]),a("el-button",{attrs:{icon:"el-icon-upload2",type:"primary",title:"上传/修改建筑物图片"},on:{click:function(i){return e.handleDialog()}}})],1)],1)],1):e._e(),e.hasAuth?a("img",{staticClass:"preview-img",staticStyle:{cursor:"pointer",height:"calc((100vh - 110px) - 11rem)"},attrs:{src:e.imgUrl,alt:"加载失败"},on:{click:function(i){e.dialogImgVisible=!0,e.dialogImgUrl=e.imgUrl}}}):e._e(),a("el-dialog",{attrs:{visible:e.dialog.visible},on:{"update:visible":function(i){return e.$set(e.dialog,"visible",i)}}},[a("div",{staticClass:"el-dialog-title-custom",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-txt"},[e._v("建筑物图片")]),a("img",{attrs:{src:t(1612)}})]),a("el-form",{ref:"dialogForm",attrs:{model:e.dialog.forms,rules:e.dialog.rules,"label-width":"150px"}},[e.dialog.visible?a("el-form-item",{attrs:{label:"图片",prop:"cValue"}},[a("div",{staticClass:"preview-grid"},[a("el-upload",{ref:"upload",staticClass:"upload-container",attrs:{name:"attach",headers:e.headers,action:e.uploadUrl,data:e.uploadData,"on-success":e.uploadSuccess,"on-remove":e.fileRemove,limit:1,drag:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v(" 点击 "),a("em",[e._v("上传文件")]),e._v(" 或拖拽上传 ")])]),e.dialog.forms.cValue?a("img",{staticClass:"preview-img",attrs:{src:e.dialog.forms.cValue,alt:"图片加载失败"}}):e._e()],1)]):e._e()],1),a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:e.dialogSubmit}},[e._v("保 存")])],1)],1),a("el-dialog",{attrs:{"custom-class":"dialog-img",visible:e.dialogImgVisible},on:{"update:visible":function(i){e.dialogImgVisible=i}}},[a("img",{staticClass:"preview-img",attrs:{src:e.dialogImgUrl,alt:"加载失败"}})])],1):e._e()},s=[],l=(t(98803),t(94685)),r=t(7169),o=t(47254),n=t(81753),d={components:{pagination:l.Z},data(){return{showPage:!1,hasAuth:!0,uploadedFileUrl:"",headers:{token:(0,n.LP)()},uploadData:{type:1},uploadUrl:o.P,imgUrl:"",dialog:{visible:!1,forms:{},rules:{cValue:[{required:!0,message:"请上传图片"}]}},dialogImgVisible:!1,dialogImgUrl:""}},created(){(0,r.uh)().then((e=>{this.hasAuth=!0,this.imgUrl=e.data.imgUrl})).catch((e=>{this.hasAuth=!1})).finally((e=>{this.showPage=!0}))},mounted(){},methods:{handleReset(){document.activeElement.blur(),(0,r.qN)().then((e=>{this.$message.success("操作成功!")}))},uploadSuccess(e,i,t){0===e.res?(this.dialog.forms.cValue=e.data.filePath,this.$message.success("上传成功!")):this.$message.error(e.msg),this.$refs["dialogForm"].validateField("cValue")},fileRemove(e,i){this.dialog.forms.cValue="",this.$refs["dialogForm"].validateField("cValue")},dialogSubmit(){this.$refs["dialogForm"].validate(((e,i)=>{if(!e)return!1;(0,r.cO)(this.dialog.forms).then((e=>{this.$message.success("操作成功!"),this.$refs["dialogForm"].resetFields(),this.dialog.visible=!1,(0,r.uh)().then((e=>this.imgUrl=e.data.imgUrl))}))}))},handleDialog(e){this.dialog.forms=e?JSON.parse(JSON.stringify(e)):{cValue:""},this.dialog.visible=!0,this.$nextTick((e=>this.$refs["dialogForm"].clearValidate()))}}},c=d,u=t(1001),m=(0,u.Z)(c,a,s,!1,null,"6bb9dd5e",null),g=m.exports},47254:function(e,i,t){t.d(i,{P:function(){return s}});t(25972);const a="",s=a+"/admin/uploadFile/upload"},98803:function(e,i,t){t.d(i,{C0:function(){return r},Mj:function(){return a},Uz:function(){return o},eW:function(){return l},ed:function(){return s}});t(21703);const a=[{id:1,name:"整型"},{id:2,name:"长整型"},{id:3,name:"浮点型"},{id:4,name:"布尔型"},{id:5,name:"字符串"},{id:6,name:"时间戳"}],s=[{id:1,name:"邮箱"},{id:2,name:"短信"},{id:3,name:"语音"},{id:4,name:"微信"},{id:5,name:"钉钉"},{id:6,name:"声光"}],l=[{id:1,name:"北向开关"},{id:2,name:"东向开关"},{id:3,name:"西向开关"},{id:4,name:"南向开关"},{id:5,name:"温度计"}],r=(e,i,t)=>{e.required||void 0!==i&&""!==i||t(),""===i||!Number.isInteger(+i)||+i<0?t(new Error("请输入整数值")):t()},o=(e,i,t)=>{""===i||isNaN(i)||Number(i)<0?t(new Error("请输入非负数字")):t()}}}]);