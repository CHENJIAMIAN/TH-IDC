"use strict";(self["webpackChunkTH_IDC"]=self["webpackChunkTH_IDC"]||[]).push([[3981],{72802:function(t,e,i){i.d(e,{P:function(){return a}});i(63810);const l="",a=l+"/admin/uploadFile/upload"},41849:function(t,e,i){i.d(e,{C0:function(){return o},Mj:function(){return l},Uz:function(){return r},eW:function(){return s},ed:function(){return a}});i(48503);const l=[{id:1,name:"整型"},{id:2,name:"长整型"},{id:3,name:"浮点型"},{id:4,name:"布尔型"},{id:5,name:"字符串"},{id:6,name:"时间戳"}],a=[{id:1,name:"邮箱"},{id:2,name:"短信"},{id:3,name:"语音"},{id:4,name:"微信"},{id:5,name:"钉钉"},{id:6,name:"声光"}],s=[{id:1,name:"北向开关"},{id:2,name:"东向开关"},{id:3,name:"西向开关"},{id:4,name:"南向开关"},{id:5,name:"温度计"}],o=(t,e,i)=>{t.required||void 0!==e&&""!==e||i(),""===e||!Number.isInteger(+e)||+e<0?i(new Error("请输入整数值")):i()},r=(t,e,i)=>{""===e||isNaN(e)||Number(e)<0?i(new Error("请输入非负数字")):i()}},63981:function(t,e,i){i.r(e),i.d(e,{default:function(){return f}});var l=function(){var t=this,e=t.$createElement,l=t._self._c||e;return t.showPage?l("div",{staticClass:"app-container floor-manage"},[t.hasAuth?t._e():l("h2",{staticClass:"auth-tip"},[t._v("权限不足,请联系管理员")]),t.hasAuth?l("div",{staticClass:"head"},[l("el-form",{ref:"filterForm",attrs:{inline:!0,size:"medium",model:t.filterForm}},[l("el-form-item",[l("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(e){return t.handleDialog()}}},[l("i",{staticClass:"el-icon-plus"})])],1)],1)],1):t._e(),t.hasAuth?l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{"empty-text":" ",height:"100%",stripe:"",border:"",data:t.listData}},[l("el-table-column",{attrs:{prop:"floorCode",label:"楼层编号"}}),l("el-table-column",{attrs:{prop:"name",label:"楼层名称"}}),l("el-table-column",{attrs:{prop:"imgUrl",label:"预览图"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[l("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){t.dialogImgVisible=!0,t.dialogImgUrl=i.imgUrl}}},[t._v("查看")])]}}],null,!1,2063936953)}),l("el-table-column",{attrs:{sortable:"",prop:"sort",label:"排序"}}),l("el-table-column",{attrs:{label:"操作",align:"center",width:"161"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[l("el-button",{attrs:{title:"编辑",icon:"el-icon-edit-outline",type:"primary",plain:""},on:{click:function(e){return t.handleDialog(i)}}}),l("el-button",{attrs:{title:"删除",icon:"el-icon-delete",type:"primary",plain:""},on:{click:function(e){return t.handleDel(i.id)}}})]}}],null,!1,1998501215)})],1):t._e(),t.hasAuth?l("pagination",{attrs:{hidden:!(t.listTotal>0),total:t.listTotal,page:t.filterForm.pageNo,limit:t.filterForm.pageSize},on:{"update:page":function(e){return t.$set(t.filterForm,"pageNo",e)},"update:limit":function(e){return t.$set(t.filterForm,"pageSize",e)},pagination:t.getList}}):t._e(),l("el-dialog",{attrs:{"custom-class":"dialog-img",visible:t.dialogImgVisible},on:{"update:visible":function(e){t.dialogImgVisible=e}}},[l("img",{staticClass:"preview-img",attrs:{src:t.dialogImgUrl,alt:"加载失败"}})]),l("el-dialog",{attrs:{visible:t.dialog.visible},on:{"update:visible":function(e){return t.$set(t.dialog,"visible",e)}}},[l("div",{staticClass:"el-dialog-title-custom",attrs:{slot:"title"},slot:"title"},[l("span",{staticClass:"title-txt"},[t._v(t._s(t.dialog.forms.id?"编辑":"新增"))]),l("img",{attrs:{src:i(1612)}})]),l("el-form",{ref:"dialogForm",attrs:{model:t.dialog.forms,rules:t.dialog.rules,"label-width":"150px"}},[l("el-form-item",{attrs:{label:"楼层编号",prop:"floorCode"}},[l("el-input",{attrs:{disabled:!!t.dialog.forms.id},model:{value:t.dialog.forms.floorCode,callback:function(e){t.$set(t.dialog.forms,"floorCode",e)},expression:"dialog.forms.floorCode"}})],1),l("el-form-item",{attrs:{label:"楼层名称",prop:"name"}},[l("el-input",{model:{value:t.dialog.forms.name,callback:function(e){t.$set(t.dialog.forms,"name",e)},expression:"dialog.forms.name"}})],1),l("el-form-item",{attrs:{label:"排序",prop:"sort"}},[l("el-input",{model:{value:t.dialog.forms.sort,callback:function(e){t.$set(t.dialog.forms,"sort",e)},expression:"dialog.forms.sort"}})],1),t.dialog.visible?l("el-form-item",{attrs:{label:"预览图",prop:"imgUrl"}},[l("div",{staticClass:"preview-grid"},[l("el-upload",{ref:"upload",staticClass:"upload-container",attrs:{name:"attach",headers:t.headers,action:t.uploadUrl,data:t.uploadData,"on-success":t.uploadSuccess,"on-remove":t.fileRemove,limit:1,drag:""}},[l("i",{staticClass:"el-icon-upload"}),l("div",{staticClass:"el-upload__text"},[t._v(" 点击 "),l("em",[t._v("上传文件")]),t._v(" 或拖拽上传 ")])]),t.dialog.forms.imgUrl?l("img",{staticClass:"preview-img",attrs:{src:t.dialog.forms.imgUrl,alt:"图片加载失败"}}):t._e()],1)]):t._e()],1),l("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[l("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:t.dialogSubmit}},[t._v("保 存")])],1)],1)],1):t._e()},a=[],s=i(41849),o=i(87130),r=i(5211),n=i(72802),d=i(41730),m={components:{pagination:o.Z},data(){return{showPage:!1,hasAuth:!0,uploadedFileUrl:"",headers:{token:(0,d.LP)()},uploadData:{type:1},uploadUrl:n.P,filterForm:{pageNo:1,pageSize:10},listLoading:!0,listData:[],listTotal:0,dialogImgVisible:!1,dialogImgUrl:"",dialog:{id:"",visible:!1,forms:{},rules:{floorCode:[{required:!0,trigger:"blur",message:"请输入"}],name:[{required:!0,trigger:"blur",message:"请输入"}],imgUrl:[{required:!0,message:"请上传图片"}],sort:[{required:!0,trigger:"blur",validator:s.C0}]}}}},created(){this.handleQuery()},mounted(){},methods:{uploadSuccess(t,e,i){0===t.res?(this.dialog.forms.imgUrl=t.data.filePath,this.$message.success("上传成功!")):this.$message.error(t.msg),this.$refs["dialogForm"].validateField("imgUrl")},fileRemove(t,e){this.dialog.forms.imgUrl="",this.$refs["dialogForm"].validateField("imgUrl")},dialogSubmit(){this.$refs["dialogForm"].validate(((t,e)=>{if(!t)return!1;{let t=null;t=this.dialog.forms.id?r.oW:r.Ch,t(this.dialog.forms).then((t=>{this.$message.success("操作成功!"),this.$refs["dialogForm"].resetFields(),this.dialog.visible=!1,this.getList()}))}}))},handleQuery(){this.listTotal=0,this.filterForm.pageNo=1,this.getList()},handleReset(t){document.activeElement.blur(),this.$refs[t].resetFields(),this.handleQuery()},handleDialog(t){this.dialog.forms=t?JSON.parse(JSON.stringify(t)):{imgUrl:""},this.dialog.visible=!0,this.$nextTick((t=>this.$refs["dialogForm"].clearValidate()))},handleDel(t){this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,r.Jd)({id:t}).then((t=>{this.getList(),this.$message.success("删除成功!")}))})).catch((()=>{}))},getList(){this.listLoading=!0,(0,r.fB)(this.filterForm).then((t=>{this.hasAuth=!0,this.listData=t.data.list,this.listTotal=t.data.total,this.listLoading=!1})).catch((t=>{this.hasAuth=!1})).finally((t=>{this.showPage=!0}))}}},u=m,g=i(35471),c=(0,g.Z)(u,l,a,!1,null,"49607f30",null),f=c.exports}}]);